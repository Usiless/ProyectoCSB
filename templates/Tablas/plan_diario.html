{% extends 'base.html' %}
{% block title %}{{title}}{% endblock %}
{% block content %}
<style>
    a.right {
        float: right;
    }
</style>
<div class="container">
    <form method="post" id="myForm" onSubmit="return confirm('Confirmar cambios?');" enctype="multipart/form-data">
        <div class="input-group gap-2 mb-2">
            {% if session['rol'] not in ('admin','directivo')%} 
            <input name="aprob" value="{{data[8]}}" hidden />
            {%endif%}
            <div class="mt-3 col-3">
                <label for="grado" class="form-label">Grado</label>
                <select id="grado" class="form-select form-control" name="grado" required onchange="filter_grado()">
                    <option selected value="">Seleccionar Grado</option>
                    {%for row in data_sec%}
                    <option value={{row[0]}} {% if row[0]==data[1]%} selected {% endif %}>{{row[1]}} - {{row[2]}}</option>
                    {%endfor%}
                </select>
            </div>
            <div class="mt-3 col-3">
                <label for="profesor" class="form-label">Profesor</label>
                <select id="profesor" class="form-select" name="profesor" required onchange="filter_prof()">
                    <option selected value="">Seleccionar Profesor</option>
                    {%for row in data_sec_2%}
                    <option value={{row[1]}} grado="{{row[0]}}" {% if row[1]==data[3]%} selected {% endif %}>{{row[3]}}</option>
                    {%endfor%}
                </select>
            </div>
            <div class="mt-3 col-3">
                <label for="materia" class="form-label">Materia</label>
                <select id="materias" class="form-select" name="materias" required onchange="filter_mat()">
                    <option selected value="">Seleccionar Materia</option>
                    {%for row in data_sec_3%}
                    <option value={{row[2]}} profesor="{{row[1]}}" grado="{{row[0]}}" {% if row[2]==data[2]%} selected {% endif %}>{{row[3]}}</option>
                    {%endfor%}
                </select>
            </div>
            <div class="mt-3 col-3">
                <label for="fecha" class="form-label">Fecha</label>
                <input type="date" class="form-control" id="fecha" name="fecha" value="{{data[5]}}" required autofocus />
            </div>
            <div class="mt-3 col-3">
                <label for="titulo" class="form-label">Título</label>
                <input type="text" class="form-control" id="titulo" name="titulo" value="{{data[4]}}" required autofocus />
            </div>
            <div class="mt-3 col-9">
                <label for="descrip" class="form-label">Descripción</label>
                <textarea class="form-control" id="descripcion" name="descripcion" rows="10" maxlength="65535" required autofocus>
                {{data[6]}}
                </textarea>
            </div>
        </div>
        <div class="mb-2 col-9">
            <label for="anexo" class="form-label">Anexo</label>
            <div class="input-group">
                <input class="form-control col-6" type="file" name="anexo" accept="image/png, image/gif, image/jpeg" />
                {%if data[7]%}
                <a class="btn btn-primary col-2" href="{{url_for('descarga_anexo', id=data[0])}}" target="_blank">Descargar</a>
                {%endif%}
            </div>
        </div>
        <div class="col-9 mb-2">
            <label for="anexo" class="form-label">Aprobación</label>
            <select id="aprob" class="form-select" name="aprob" {% if session['rol'] not in ('admin','directivo')%} disabled {%endif%}>
                <option value="0" {% if data[8]|int==0%} selected {% endif %}>Pendiente</option>
                <option value="1" {% if data[8]|int==1%} selected {% endif %}>Aprobado</option>
                <option value="2" {% if data[8]|int==2%} selected {% endif %}>Rechazado</option>
            </select>
        </div>
        <div id="botones" class="d-grid gap-2 d-md-flex justify-content-md-end"></div>
    </form>
</div>
<script>
    $(document).ready(function filter_grado_start() {
        hide_prof();
        hide_mats();
    });

    function filter_grado() {
        let prof_select = document.getElementById("profesor");
        let mat_select = document.getElementById("materias");
        prof_select.options[prof_select.selectedIndex].selected = false;
        mat_select.options[mat_select.selectedIndex].selected = false;
        hide_prof();
        hide_mats();
    }

    function filter_prof() {
        let mat_select = document.getElementById("materias");
        mat_select.options[mat_select.selectedIndex].selected = false;
        hide_mats();
    }

    function hide_prof() {
        let grado_show = document.getElementById("grado");
        let grado = grado_show.options[grado_show.selectedIndex].getAttribute("value");
        let prof_select = document.getElementById("profesor");
        let profs = prof_select.options;

        if (grado > 0) {
            prof_select.disabled = false;
        }
        else {
            prof_select.disabled = true;
        }

        for (let i = 0; i < profs.length; i++) {
            let a = profs[i];
            if (a.getAttribute("grado") == grado) {
                a.hidden = false;
            }
            else {
                a.hidden = true;
            }
        }
    }

    function hide_mats() {
        let grado_show = document.getElementById("grado");
        let grado = grado_show.options[grado_show.selectedIndex].getAttribute("value");
        let prof_select = document.getElementById("profesor");
        let prof = prof_select.options[prof_select.selectedIndex].getAttribute("value");
        let mat_select = document.getElementById("materias");
        let mats = mat_select.options;
        if (grado > 0 && prof > 0) {
            mat_select.disabled = false;
        }
        else {
            mat_select.disabled = true;
        }

        for (let i = 0; i < mats.length; i++) {
            let a = mats[i];
            if (a.getAttribute("grado") == grado && a.getAttribute("profesor") == prof) {
                a.hidden = false;
            }
            else {
                a.hidden = true;
            }
        }
    }

</script>
<script type="text/javascript" src="{{url_for('static', filename='date_today.js')}}"></script>
<script type="text/javascript" id="botones_js" data="{{ data }}" actualizar="{{ permisos[0] }}" eliminar="{{ permisos[1] }}" src="{{url_for('static', filename='generar_botones.js')}}"></script>
{% endblock %}
